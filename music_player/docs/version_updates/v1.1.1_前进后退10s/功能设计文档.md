# â© v1.1.1 - å‰è¿›/åé€€10ç§’åŠŸèƒ½è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v1.1.1  
**æ›´æ–°æ—¥æœŸ**: 2025å¹´8æœˆ25æ—¥  
**å¼€å‘è€…**: lvy010  
**åŠŸèƒ½æ¨¡å—**: éŸ³é¢‘è¿›åº¦æ§åˆ¶å¢å¼º  

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
å®ç°ç²¾ç¡®çš„éŸ³é¢‘è¿›åº¦è·³è½¬åŠŸèƒ½ï¼Œæ”¯æŒå¿«é€Ÿå‰è¿›å’Œåé€€10ç§’ï¼Œæå‡ç”¨æˆ·åœ¨é•¿éŸ³é¢‘å†…å®¹ä¸­çš„å¯¼èˆªä½“éªŒã€‚

### âœ¨ ä¸»è¦ç‰¹æ€§
1. **â© å¿«è¿›10ç§’** - ä¸€é”®è·³è½¬åˆ°å½“å‰ä½ç½®+10ç§’
2. **âª å¿«é€€10ç§’** - ä¸€é”®è·³è½¬åˆ°å½“å‰ä½ç½®-10ç§’
3. **ğŸ¯ ç²¾ç¡®å®šä½** - æ¯«ç§’çº§ç²¾åº¦çš„è¿›åº¦æ§åˆ¶
4. **ğŸ”„ è¾¹ç•Œå¤„ç†** - æ™ºèƒ½å¤„ç†æ–‡ä»¶å¼€å§‹/ç»“æŸè¾¹ç•Œ
5. **ğŸ“± è§†è§‰åé¦ˆ** - æ“ä½œæ—¶çš„è¿›åº¦æ¡åŠ¨ç”»æ•ˆæœ

---

## ğŸ¨ UIè®¾è®¡è§„èŒƒ

### ğŸ“± æ§åˆ¶æŒ‰é’®å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ğŸµ å½“å‰æ’­æ”¾               â”‚
â”‚     â®ï¸    âª10s   â¯ï¸   â©10s   â­ï¸    â”‚  â† æ§åˆ¶æŒ‰é’®ç»„
â”‚         ä¸Šä¸€é¦–  åé€€  æ’­æ”¾  å‰è¿›  ä¸‹ä¸€é¦– â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ¨ æŒ‰é’®è®¾è®¡è§„èŒƒ
- **å°ºå¯¸**: 64x64px (æ¯”å…¶ä»–æŒ‰é’®ç¨å°)
- **é¢œè‰²**: æ·±ç°èƒŒæ™¯ + è“è‰²å›¾æ ‡
- **å½¢çŠ¶**: åœ†å½¢æŒ‰é’®ï¼Œ16pxåœ†è§’
- **åé¦ˆ**: ç‚¹å‡»æ—¶ç¼©æ”¾æ•ˆæœ + é¢œè‰²å˜åŒ–
- **é—´è·**: æŒ‰é’®é—´è·20px

### ğŸ“Š è¿›åº¦æ˜¾ç¤ºå¢å¼º
```c
// è¿›åº¦æ¡ä¸Šæ–¹æ˜¾ç¤ºè·³è½¬æç¤º
"âª -10s" æˆ– "â© +10s"
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### ğŸ“Š æ•°æ®ç»“æ„æ‰©å±•

```c
// éŸ³é¢‘æ§åˆ¶ç»“æ„æ‰©å±•
typedef struct {
    // ... ç°æœ‰å­—æ®µ ...
    
    // 10ç§’è·³è½¬ç›¸å…³
    bool seek_pending;          // æ˜¯å¦æœ‰å¾…å¤„ç†çš„è·³è½¬
    int64_t seek_target_ms;     // ç›®æ ‡è·³è½¬ä½ç½®(æ¯«ç§’)
    int64_t last_seek_time;     // ä¸Šæ¬¡è·³è½¬æ—¶é—´
    
    // è¿›åº¦æ˜¾ç¤º
    int64_t current_position_ms; // å½“å‰æ’­æ”¾ä½ç½®(æ¯«ç§’)
    int64_t total_duration_ms;   // æ€»æ—¶é•¿(æ¯«ç§’)
    
    // è·³è½¬åé¦ˆ
    char seek_feedback_text[32]; // è·³è½¬åé¦ˆæ–‡å­—
    lv_timer_t* feedback_timer;  // åé¦ˆæ˜¾ç¤ºå®šæ—¶å™¨
} audioctl_s;
```

### ğŸ¯ æ ¸å¿ƒAPIå®ç°

```c
/**
 * @brief å¿«è¿›10ç§’
 */
int audio_ctl_seek_forward_10s(audioctl_s* ctl) {
    if (!ctl || ctl->state != AUDIO_CTL_STATE_START) {
        return -1;
    }
    
    int64_t target_pos = ctl->current_position_ms + 10000; // +10ç§’
    
    // è¾¹ç•Œæ£€æŸ¥
    if (target_pos >= ctl->total_duration_ms) {
        target_pos = ctl->total_duration_ms - 1000; // ç•™1ç§’ç¼“å†²
    }
    
    return audio_ctl_seek_to_position(ctl, target_pos);
}

/**
 * @brief å¿«é€€10ç§’
 */
int audio_ctl_seek_backward_10s(audioctl_s* ctl) {
    if (!ctl || ctl->state != AUDIO_CTL_STATE_START) {
        return -1;
    }
    
    int64_t target_pos = ctl->current_position_ms - 10000; // -10ç§’
    
    // è¾¹ç•Œæ£€æŸ¥
    if (target_pos < 0) {
        target_pos = 0; // å›åˆ°å¼€å§‹
    }
    
    return audio_ctl_seek_to_position(ctl, target_pos);
}

/**
 * @brief ç²¾ç¡®è·³è½¬åˆ°æŒ‡å®šä½ç½®
 */
int audio_ctl_seek_to_position(audioctl_s* ctl, int64_t position_ms) {
    if (!ctl) return -1;
    
    MP3_LOG("ğŸ¯ è·³è½¬åˆ°ä½ç½®: %lld ms", position_ms);
    
    // è®¾ç½®è·³è½¬æ ‡å¿—
    ctl->seek_pending = true;
    ctl->seek_target_ms = position_ms;
    ctl->last_seek_time = get_current_time_ms();
    
    // è®¡ç®—æ–‡ä»¶åç§»é‡
    if (ctl->audio_format == AUDIO_FORMAT_MP3) {
        // MP3éœ€è¦é‡æ–°è§£ç åˆ°ç›®æ ‡ä½ç½®
        ctl->seek_position = calculate_mp3_file_offset(ctl, position_ms);
    } else if (ctl->audio_format == AUDIO_FORMAT_WAV) {
        // WAVå¯ä»¥ç›´æ¥è®¡ç®—åç§»é‡
        ctl->seek_position = calculate_wav_file_offset(ctl, position_ms);
    }
    
    // æ›´æ–°UIåé¦ˆ
    update_seek_feedback_ui(ctl, position_ms);
    
    return 0;
}
```

### ğŸ¨ UIäº‹ä»¶å¤„ç†

```c
/**
 * @brief å¿«è¿›æŒ‰é’®äº‹ä»¶å¤„ç†
 */
static void forward_10s_btn_event_cb(lv_event_t* e) {
    lv_event_code_t code = lv_event_get_code(e);
    
    if (code == LV_EVENT_CLICKED) {
        // æ‰§è¡Œå¿«è¿›
        if (audio_ctl_seek_forward_10s(C.audio_ctl) == 0) {
            // æ˜¾ç¤ºåé¦ˆåŠ¨ç”»
            show_seek_feedback("â© +10s");
            
            // æ›´æ–°è¿›åº¦æ¡
            update_progress_bar_immediately();
        }
    } else if (code == LV_EVENT_PRESSED) {
        // æŒ‰ä¸‹æ—¶çš„è§†è§‰åé¦ˆ
        lv_obj_set_style_transform_scale(lv_event_get_target(e), 95, LV_PART_MAIN);
        lv_obj_set_style_bg_color(lv_event_get_target(e), lv_color_hex(0x3B82F6), LV_PART_MAIN);
    } else if (code == LV_EVENT_RELEASED) {
        // é‡Šæ”¾æ—¶æ¢å¤
        lv_obj_set_style_transform_scale(lv_event_get_target(e), 100, LV_PART_MAIN);
        lv_obj_set_style_bg_color(lv_event_get_target(e), lv_color_hex(0x374151), LV_PART_MAIN);
    }
}

/**
 * @brief å¿«é€€æŒ‰é’®äº‹ä»¶å¤„ç†
 */
static void backward_10s_btn_event_cb(lv_event_t* e) {
    lv_event_code_t code = lv_event_get_code(e);
    
    if (code == LV_EVENT_CLICKED) {
        // æ‰§è¡Œå¿«é€€
        if (audio_ctl_seek_backward_10s(C.audio_ctl) == 0) {
            // æ˜¾ç¤ºåé¦ˆåŠ¨ç”»
            show_seek_feedback("âª -10s");
            
            // æ›´æ–°è¿›åº¦æ¡
            update_progress_bar_immediately();
        }
    } else if (code == LV_EVENT_PRESSED) {
        // æŒ‰ä¸‹æ—¶çš„è§†è§‰åé¦ˆ
        lv_obj_set_style_transform_scale(lv_event_get_target(e), 95, LV_PART_MAIN);
        lv_obj_set_style_bg_color(lv_event_get_target(e), lv_color_hex(0x3B82F6), LV_PART_MAIN);
    } else if (code == LV_EVENT_RELEASED) {
        // é‡Šæ”¾æ—¶æ¢å¤
        lv_obj_set_style_transform_scale(lv_event_get_target(e), 100, LV_PART_MAIN);
        lv_obj_set_style_bg_color(lv_event_get_target(e), lv_color_hex(0x374151), LV_PART_MAIN);
    }
}
```

---

## ğŸ“Š æµ‹è¯•ç”¨ä¾‹

### âœ… åŠŸèƒ½æµ‹è¯•
1. **åŸºç¡€è·³è½¬æµ‹è¯•**
   - åœ¨æ­Œæ›²å¼€å§‹ã€ä¸­é—´ã€ç»“å°¾ä½ç½®æµ‹è¯•Â±10sè·³è½¬
   - éªŒè¯è¾¹ç•Œæƒ…å†µå¤„ç†(å¼€å§‹å‰ã€ç»“æŸå)
   
2. **æ ¼å¼å…¼å®¹æµ‹è¯•**
   - MP3æ ¼å¼çš„è·³è½¬ç²¾åº¦æµ‹è¯•
   - WAVæ ¼å¼çš„è·³è½¬ç²¾åº¦æµ‹è¯•
   
3. **è¿ç»­æ“ä½œæµ‹è¯•**
   - å¿«é€Ÿè¿ç»­ç‚¹å‡»å‰è¿›/åé€€æŒ‰é’®
   - è·³è½¬è¿‡ç¨‹ä¸­åˆ‡æ¢æ­Œæ›²

### ğŸ“ˆ æ€§èƒ½æµ‹è¯•
- **å“åº”æ—¶é—´**: æŒ‰é’®ç‚¹å‡»åˆ°è·³è½¬å®Œæˆ < 100ms
- **ç²¾åº¦æµ‹è¯•**: è·³è½¬ä½ç½®è¯¯å·® < Â±200ms
- **å†…å­˜å½±å“**: è·³è½¬æ“ä½œä¸å¢åŠ å†…å­˜å ç”¨

---

## ğŸ” è°ƒè¯•å’Œç›‘æ§

### ğŸ“ è°ƒè¯•æ—¥å¿—
```c
#define SEEK_LOG(fmt, ...) printf("[SEEK] " fmt "\n", ##__VA_ARGS__)

// å…³é”®æ“ä½œæ—¥å¿—
SEEK_LOG("ğŸ¯ ç”¨æˆ·è¯·æ±‚è·³è½¬: %s%dç§’", direction > 0 ? "+" : "", abs(direction));
SEEK_LOG("ğŸ“ å½“å‰ä½ç½®: %lld ms, ç›®æ ‡ä½ç½®: %lld ms", current_pos, target_pos);
SEEK_LOG("âœ… è·³è½¬å®Œæˆï¼Œå®é™…ä½ç½®: %lld ms", actual_pos);
```

### ğŸ“Š æ€§èƒ½ç›‘æ§
- è·³è½¬æ“ä½œè®¡æ•°
- å¹³å‡è·³è½¬æ—¶é—´
- è·³è½¬ç²¾åº¦ç»Ÿè®¡

---

**ğŸ¯ æ€»ç»“**: è¿™ä¸ªåŠŸèƒ½å°†å¤§å¤§æå‡ç”¨æˆ·åœ¨éŸ³é¢‘å†…å®¹ä¸­çš„å¯¼èˆªä½“éªŒï¼Œç‰¹åˆ«é€‚åˆæ’­å®¢ã€æœ‰å£°ä¹¦ç­‰é•¿éŸ³é¢‘å†…å®¹çš„å¿«é€Ÿå®šä½éœ€æ±‚ã€‚

